tosca_definitions_version: tosca_simple_yaml_1_3
description: RADON model for the demo application
topology_template:
  node_templates:
    aws:
      type: radon.nodes.aws.AwsPlatform
      properties:
        name: radon-aws
        region: eu-west-1
    clients:
      type: radon.nodes.abstract.workload.ClosedWorkload
      properties:
        name: radon-clients
        population: 12
        think_time:
          mean: 10.0
        entries:
          start:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                request_pattern: deterministic
              a2:
                service_time:
                  mean: 10.0
              a3:
                service_time:
                  mean: 0.001
                request_pattern: deterministic
              a4:
                service_time:
                  mean: 0.001
                request_pattern: deterministic
              a5:
                service_time:
                  mean: 0.001
                request_pattern: deterministic
            precedences:
              - type: sequence
                pre_activities:
                  - a1
                post_activities:
                  - a2
              - type: sequence
                pre_activities:
                  - a2
                post_activities:
                  - a3
              - type: sequence
                pre_activities:
                  - a3
                post_activities:
                  - a4
              - type: sequence
                pre_activities:
                  - a4
                post_activities:
                  - a5
      requirements:
        - endpoint:
            node: uploads
            relationship: clients_connects_to_uploads
            capability: storage_endpoint
        - endpoint:
            node: thumbnails
            relationship: clients_connects_to_thumbnails
            capability: storage_endpoint
    uploads:
      type: radon.nodes.aws.AwsS3Bucket
      properties:
        name: radon-uploads
        entries:
          get:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
          put:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
              a2:
                service_time:
                  mean: 0.104
              a3:
                service_time:
                  mean: 0.001
                request_pattern: deterministic
            precedences:
              - type: sequence
                pre_activities:
                  - a1
                post_activities:
                  - a2
              - type: sequence
                pre_activities:
                  - a2
                post_activities:
                  - a3
          delete:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
      requirements:
        - host:
            node: aws
            relationship: uploads_hosted_on_aws
            capability: host
        - invoker:
            node: create_thumbnail
            relationship: uploads_triggers_create_thumbnail
            capability: invocable
    thumbnails:
      type: radon.nodes.aws.AwsS3Bucket
      properties:
        name: radon-thumbnails
        entries:
          get:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
          put:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
              a2:
                service_time:
                  mean: 0.104
            precedences:
              - type: sequence
                pre_activities:
                  - a1
                post_activities:
                  - a2
          delete:
            activities:
              a1:
                service_time:
                  mean: 0.001
                bound_to_entry: true
                replies_to_entry: true
      requirements:
        - host:
            node: aws
            relationship: thumbnails_hosted_on_aws
            capability: host
    create_thumbnail:
      type: radon.nodes.aws.AwsLambdaFunction
      properties:
        name: radon-create-thumbnail
        handler: index.handler
        memory: 128
        concurrency: 1
        runtime: nodejs10.x
        statement_id: lambda-f15b7cb2-1cf5-47e7-bd41-8e7461293952
        zip_file: create_thumbnail.zip
        timeout: 8
        entries:
          execute:
            activities:
              a1:
                service_time:
                  mean: 0.066
                bound_to_entry: true
                request_pattern: deterministic
              a2:
                service_time:
                  mean: 2.311
              a3:
                service_time:
                  mean: 0.083
                request_pattern: deterministic
            precedences:
              - type: sequence
                pre_activities:
                  - a1
                post_activities:
                  - a2
              - type: sequence
                pre_activities:
                  - a2
                post_activities:
                  - a3
      requirements:
        - host:
            node: aws
            relationship: create_thumbnail_hosted_on_aws
            capability: host
        - endpoint:
            node: uploads
            relationship: create_thumbnail_connects_to_uploads
            capability: storage_endpoint
        - endpoint:
            node: thumbnails
            relationship: create_thumbnail_connects_to_thumbnails
            capability: storage_endpoint
  relationship_templates:
    uploads_hosted_on_aws:
      type: tosca.relationships.HostedOn
    thumbnails_hosted_on_aws:
      type: tosca.relationships.HostedOn
    create_thumbnail_hosted_on_aws:
      type: tosca.relationships.HostedOn
    clients_connects_to_uploads:
      type: radon.relationships.ConnectsTo
      properties:
        interactions:
          - type: synchronous
            source_activity: start.a1
            target_entry: put
            number_of_requests: 1.0
            network_delay:
              mean: 0.197
          - type: synchronous
            source_activity: start.a4
            target_entry: delete
            number_of_requests: 1.0
            network_delay:
              mean: 0.103
    clients_connects_to_thumbnails:
      type: radon.relationships.ConnectsTo
      properties:
        interactions:
          - type: synchronous
            source_activity: start.a3
            target_entry: get
            number_of_requests: 1.0
            network_delay:
              mean: 0.107
          - type: synchronous
            source_activity: start.a5
            target_entry: delete
            number_of_requests: 1.0
            network_delay:
              mean: 0.035
    uploads_triggers_create_thumbnail:
      type: radon.relationships.aws.AwsTriggers
      properties:
        events: s3:ObjectCreated:*
        interactions:
          - type: asynchronous
            source_activity: put.a3
            target_entry: execute
            number_of_requests: 1.0
            network_delay:
              mean: 1.019
    create_thumbnail_connects_to_uploads:
      type: radon.relationships.ConnectsTo
      properties:
        interactions:
          - type: synchronous
            source_activity: execute.a1
            target_entry: get
            number_of_requests: 1.0
            network_delay:
              mean: 0.022
    create_thumbnail_connects_to_thumbnails:
      type: radon.relationships.ConnectsTo
      properties:
        interactions:
          - type: synchronous
            source_activity: execute.a3
            target_entry: put
            number_of_requests: 1.0
            network_delay:
              mean: 0.045
  policies:
    - create_thumbnail_mean_response_time:
        type: radon.policies.performance.MeanResponseTime
        properties:
          upper_bound: 1.5
        targets:
          - create_thumbnail
